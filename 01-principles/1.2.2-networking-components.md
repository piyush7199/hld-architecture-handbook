# 1.2.2 Networking Components: DNS, Load Balancers, and CDNs

## Intuitive Explanation

These three components manage the journey of a user's request across the Internet, ensuring it arrives at the correct
place quickly and safely.

- **DNS (The Phone Book):** Translates a human-readable domain name (like `google.com`) into a machine-readable IP
  address (like `192.0.2.1`).
- **Load Balancer (The Traffic Cop):** Sits in front of a group of servers and distributes incoming requests among them,
  preventing any single server from becoming overloaded.
- **CDN (The Global Cache):** Stores copies of static content (images, videos) on servers located geographically close
  to users, making websites load faster.

---

## In-Depth Analysis

### 1. Domain Name System (DNS)

DNS is a hierarchical, distributed naming system for computers, services, or any resource connected to the Internet.

- **How it Works:** The client's browser first queries a DNS server (often owned by an ISP), which recursively searches
  until it finds the authoritative server for the domain and retrieves the IP address (A record).
- **Time-to-Live (TTL):** DNS responses are heavily cached. The TTL specifies how long a record can be stored by a
  client or intermediate server before it must be requested again. A low TTL allows faster updates but increases DNS
  query traffic.
- **Geographical Routing (GeoDNS):** Some DNS services can return different IP addresses based on the user's location,
  directing them to the nearest data center.

### 2. Load Balancers (LBs)

A Load Balancer is a reverse proxy that sits between the client and a group of backend servers, distributing network
traffic efficiently. This is key to Horizontal Scaling and high Availability.

- **Layer 4 (L4) vs. Layer 7 (L7):**
    - **L4 (Transport Layer):** Distributes traffic based on IP address and port. Faster and simpler.
    - **L7 (Application Layer):** Distributes traffic based on application-level data like HTTP headers, URLs, or user
      session
      data. Used for routing to specific microservices.
- **Algorithms:**
    - **Round Robin:** Distributes requests sequentially to each server.
    - **Least Connection:** Sends new requests to the server with the fewest active connections.
    - **IP Hash:** Uses a hash of the client's IP address to ensure the same client always goes to the same server (
      Sticky Session).

- **Health Check:** Continuously monitors backend server health and automatically removes unhealthy servers from the
  pool.

### 3. Content Delivery Network (CDN)

A CDN is a geographically distributed network of proxy servers and their data centers. The goal is to provide high
availability and performance by distributing service spatially relative to end-users.

- **Function:** Caches static assets (HTML, CSS, JS, images, videos) close to the user.
- **Benefit:** Reduces latency and decreases the load on the origin servers.
- **Edge Servers:** The CDN nodes closest to the user are called edge servers. When a user requests an image, the
  request goes to the nearest edge server, not the main data center.

### Key Concepts / Tradeoffs

| Component     | Rationale                                                             | Trade-off / Scalability Issue                                                                                                      |
|---------------|-----------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| Load Balancer | Eliminates SPOF at the application level; enables horizontal scaling. | Introduces a potential SPOF for the LB itself (requires LB redundancy, Active/Passive or Active/Active).                           |
| CDN           | Massively reduces latency and origin server bandwidth costs.          | Cache Invalidation becomes complex; developers must manage how quickly updated content propagates across the CDN's global network. |
| DNS TTL       | Setting a low TTL allows quick system updates or failover.            | Low TTL means higher query traffic to DNS servers, increasing operating costs and load.                                            |

---

## üí° Real-World Use Cases

- **E-commerce (Fast Checkout):** Uses a CDN for all product images and JS assets, and uses an L7 Load Balancer to route
  authenticated users to specific shopping cart microservices.
- **Streaming Services (Netflix/YouTube):** Rely heavily on $\text{CDN}$s to handle 90% of traffic, delivering videos
  from the nearest server to ensure smooth playback (low latency).

---

## ‚úèÔ∏è Design Challenge

### Problem

You are serving a high-resolution, 100 MB video file to a global audience. You are charged $0.01 per GB of bandwidth
from your main data center. Explain why using a CDN is a critical cost-saving and performance choice. What must your
team monitor regarding the video asset?

### Solution

#### üéØ Scenario Overview

- You‚Äôre serving a 100 MB video file globally.
- Bandwidth cost from main data center = $0.01 / GB.
- Users are worldwide, meaning high latency and repeated downloads of the same file.

We must explain why CDN is critical (cost + performance), and what to monitor about the video asset.

#### üí∞ 1Ô∏è‚É£ Cost-Saving Rationale

**Without a CDN**

- Every time a user downloads the 100 MB file, it comes directly from your main data center.
- That means:
    - Bandwidth costs scale linearly with the number of views.
    - If 1 million users download it:

        ```
        1,000,000√ó100MB=100,000GB=100TB
        100,000GB√ó$0.01=$1,000
        ```

- And every request travels across long network paths ‚Äî high latency + packet loss risk.

**With a CDN**

- The first user in a region triggers the CDN edge node to cache the video.
- Subsequent users in the same region get it locally from that edge.
- So only a small percentage of requests (cache misses) hit your data center ‚Üí drastically lower bandwidth costs.

If cache hit ratio = 95%,
only 5% of traffic reaches origin ‚Üí bandwidth cost drops by ~95%.

**‚úÖ Result:** You pay for only a fraction of global bandwidth while improving performance.

#### ‚ö° 2Ô∏è‚É£ Performance Benefits

- Lower Latency: Users fetch from nearest edge node (milliseconds away vs hundreds of ms).
- Higher Throughput: CDN edge servers optimized for video streaming (HTTP/2, TCP tuning).
- Resilience: CDN absorbs DDoS and load spikes; origin isn‚Äôt overwhelmed.
- Global Scalability: No need to replicate your data center worldwide.

#### üìà 3Ô∏è‚É£ What Your Team Must Monitor

Even with a CDN, you‚Äôre still responsible for ensuring correct caching and delivery. Key metrics:

| Category                       | What to Monitor                                     | Why It Matters                                                                    |
|--------------------------------|-----------------------------------------------------|-----------------------------------------------------------------------------------|
| **Cache Efficiency**           | **Cache Hit Ratio / Miss Ratio**                    | Indicates how effectively CDN is serving content (higher = lower cost & latency). |
| **Origin Bandwidth Usage**     | How much data is fetched from your main data center | Directly tied to your bill; should be minimal.                                    |
| **Edge Latency & Error Rates** | CDN edge response times, 4xx/5xx rates              | Detect regional performance issues or misconfigurations.                          |
| **TTL / Cache Invalidation**   | Ensure correct cache-control headers                | Avoid serving stale or outdated video versions.                                   |
| **Video Integrity**            | File checksum / content hash                        | Detect corrupted uploads or partial files.                                        |
| **Regional Traffic Patterns**  | User location stats                                 | Optimize CDN PoP (Point of Presence) distribution and pre-warming.                |

#### ‚úÖ Final Summary

| Aspect                  | Explanation                                                                                  |
|-------------------------|----------------------------------------------------------------------------------------------|
| **Why CDN is critical** | Caches video near users ‚Üí cuts latency, reduces origin bandwidth (and cost) by up to 90‚Äì95%. |
| **Main benefit**        | Massive **cost savings** + **global performance improvement**.                               |
| **What to monitor**     | Cache hit ratio, origin bandwidth, error rates, cache TTL/invalidation, and file integrity.  |
